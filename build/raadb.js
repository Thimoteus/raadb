!function(a,b){b.raadb=a;var c,d,e,f,g,h,i,j,k,l,m,n,o=require("molten-core"),p=require("./middleware"),q=p.getDbEndpt,r=p.getListing,s=p.createComment,t=p.createSelfText,u=p.getCommentsFromPost,v=p.deleteThing,w=!0;d=function(a){return console.log(a),a},e=function(a){w&&d(a)},f=function(){var a,b;return a=Date.now().toString(36),b=Math.random(),b=b.toString(36),b=o.Str.drop(2,b),a+b},g=function(a){return o.lines(a.body)[0]},h=function(a){return data=o.lines(a.body)[1],JSON.parse(o.decode64(data))},i=function(a,b,c){var d,e,f;d=q(a),e={limit:100},f=function(a,d,e){var f,g;return!a&&d&&200==d.statusCode&&e?(f=function(a){return o.includes(b,a.title)},g=o.filter(f,e),c(a,g)):c(new Error("Could not contact reddit"))},r(d,e,f)},j=function(a,b,c){var d;d=f(),t(a,b,d,c)},k=function(a,b,c,d){var e;e=function(e,f){var g;return e?d(e):(g=function(a,b,c){var e=JSON.parse(c).json.data;d(a,e)},void(0===f.length&&c?j(a,b,g):f.length>0?d(e,f[0]):d(new Error("Collection "+b+" doesn't exist"))))},i(a,[b],e)},l=function(a,b,c,e){var g;void 0===e&&(e=o.id),d("inserting new doc into "+b+":"),d(c),g=function(a,b){var d,g,h;return a?e(a):(d=f(),g=o.encode64(JSON.stringify(c)),h=o.unlines([d,g]),s(b,h),void e(a,b,d))},k(a,b,!0,g)},m=function(a,b,c,d){var e,f;if(o.isType("String",c))f=function(a){return g(a)===c};else{if(!o.isType("Function",c))throw new Error("query must be a string or a predicate");f=c}e=function(b,e){return b?d(b):void u(a,e,function(a,b){var e;return e=o.filter(f,b),o.isType("String",c)?d(a,e[0]):d(a,e)})},k(a,b,!1,e)},n=function(a,b,c,d){var e;e=function(a,b){return a?d(a):(b.length?o.map(function(a){return v(a)},b):v(b),d(a))},m(a,b,c,e)},c=function(a){this.createId=f,this.docId=g,this.docData=h,this.insert=o.curry(l)(a),this.find=o.curry(m)(a),this.remove=o.curry(n)(a)},module.exports=c}({},function(){return this}());