!function(a,b){b.raadb=a;var c,d,e,f,g,h,i,j,k,l,m,n=require("molten-core"),o=require("./middleware"),p=o.getDbEndpt,q=o.getListing,r=o.createComment,s=o.createSelfText,t=o.getCommentsFromPost,u=!0;d=function(a){return console.log(a),a},e=function(a){u&&d(a)},f=function(){return Date.now().toString(36)},g=function(a){return n.lines(a.body)[0]},h=function(a){return data=n.lines(a.body)[1],JSON.parse(n.decode64(data))},i=function(a,b,c){var d,e,f;d=p(a),e={limit:100},f=function(a,d,e){var f,g;return!a&&d&&200==d.statusCode&&e?(f=function(a){return n.includes(b,a.title)},g=n.filter(f,e),c(a,g)):c(new Error("Could not contact reddit"))},q(d,e,f)},j=function(a,b,c){var d;d=f(),s(a,b,d,c)},k=function(a,b,c,d){var e;e=function(e,f){var g;return e?d(e):(g=function(a,b,c){var e=JSON.parse(c).json.data;d(a,e)},void(0===f.length&&c?j(a,b,g):f.length>0?d(e,f[0]):d(new Error("Collection "+b+" doesn't exist"))))},i(a,[b],e)},l=function(a,b,c,e){var g;void 0===e&&(e=n.id),d("inserting new doc into "+b+":"),d(c),g=function(a,b){var d,g,h;return a?e(a):(d=f(),g=n.encode64(JSON.stringify(c)),h=n.unlines([d,g]),r(b,h),void e(a,b,d))},k(a,b,!0,g)},m=function(a,b,c,d){var e,f;if(n.isType("String",c))f=function(a){return g(a)===c};else{if(!n.isType("Function",c))throw new Error("query must be a string or a predicate");f=c}e=function(b,e){return b?d(b):void t(a,e,function(a,b){var e;return e=n.filter(f,b),n.isType("String",c)?d(a,e[0]):d(a,e)})},k(a,b,!1,e)},c=function(a){this.insert=n.curry(l)(a),this.find=n.curry(m)(a),this.docId=g,this.docData=h},module.exports=c}({},function(){return this}());